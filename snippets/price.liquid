{% doc %}
  This snippet is used to render a product card.
  It is used in the product block,featured product block, and the product card block.

  @param {product} product_resource - The product to render
  @param {boolean} [show_unit_price] - Whether to show the unit price
  @param {boolean} [show_sale_price_first] - Whether to show the sale price first
{% enddoc %}

{%- liquid
  assign show_unit_price = show_unit_price | default: false
  assign show_sale_price_first = show_sale_price_first | default: false
  assign selected_variant = product_resource.selected_or_first_available_variant
  assign price = selected_variant.price
  assign compare_at_price = selected_variant.compare_at_price

  assign show_compare_price = false
  if compare_at_price > price
    assign show_compare_price = true
  endif

  if product_resource == blank and request.design_mode
    assign price = 1999
  endif

  # Checks if product handle matches the closest product's handle (i.e. product page)
  # and if the currency code is enabled for product pages
  if product.handle == closest.product.handle and settings.currency_code_enabled_product_pages
    assign price = price | money_with_currency
    assign compare_at_price = compare_at_price | money_with_currency

    # Checks if product handle does not match the closest product's handle (i.e. product card)
    # and if the currency code is enabled for product cards
  elsif product.handle != closest.product.handle and settings.currency_code_enabled_product_cards
    assign price = price | money_with_currency
    assign compare_at_price = compare_at_price | money_with_currency

  else
    assign price = price | money
    assign compare_at_price = compare_at_price | money
  endif
-%}

<div ref="priceContainer" class="custom-price-block" style="display: flex; align-items: center; gap: 0.5em;">
  <span class="custom-price-title" style="font-weight: bold; color: #8c837a; font-size: 1.3em;">BEST PRICE:</span>
  <span class="custom-price-value" style="color: #1ca000; font-weight: bold; font-size: 2em;">{{ price | default: '&nbsp;' }}</span>
  {% if show_compare_price %}
    <s class="custom-compare-at-price" style="color: #b71c1c; font-size: 1.5em; margin-left: 0.3em;">{{ compare_at_price }}</s>
    {% assign percent_off = 0 %}
    {% if compare_at_price > 0 and compare_at_price > price %}
      {% assign percent_off = ((compare_at_price | minus: price) | times: 100.0 | divided_by: compare_at_price) | round %}
    {% endif %}
    {% if percent_off > 0 %}
      <span class="custom-percent-off-tag" style="background: #b71c1c; color: #fff; font-weight: bold; font-size: 1em; padding: 0.2em 0.7em; border-radius: 4px; margin-left: 0.5em; transform: rotate(-8deg); display: inline-block;">{{ percent_off }}% off</span>
    {% endif %}
  {% endif %}
</div>
